version: "3.9"

services:
  discord-music-bot:
    container_name: discord-music-bot
    build:
      context: .
      dockerfile: Dockerfile

    restart: unless-stopped

    environment:
      NODE_ENV: production
      DISCORD_TOKEN: ${DISCORD_TOKEN}

    volumes:
      # Persist audio cache between restarts
      - ./cache:/app/cache

      # Optional: bind application.yml explicitly
      - ./application.yml:/app/application.yml:ro

    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

    stop_signal: SIGTERM
    stop_grace_period: 15s
